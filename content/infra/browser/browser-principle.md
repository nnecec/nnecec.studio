---
title: "浏览器基本原理(WIP)"
date: "2021-12-19"
tags: ["Introduction"]
description: "全面理解浏览器基本原理"
---

## 前言

每每说起原理，往往令人望而却步，总觉得原理是一个深奥难懂的底层知识。最近有种豁然开朗的感受，正如曾经中学时代对于牛顿三大定律的理解一样，听上去原理是一个极其复杂的知识，但其实它可能很简单易懂。

比如第二定律的“原理”是：物体加速度的大小跟作用力成正比，跟物体的质量成反比，且与物体质量的倒数成正比；加速度的方向跟作用力的方向相同。而描述第二定律的“代码实现”是： `∑F=kma`。我们可以又可以将这个原理应用到“实际业务”中，比如计算加速度等现实问题。

## 浏览器的组成

浏览器的主要功能就是向服务器发出请求，在浏览器窗口中展示选择的网络资源。资源的位置由用户使用 URI（统一资源标示符）指定。

浏览器的主要组成部分：

1. 用户界面 - 包括地址栏、前进/后退按钮、书签菜单等。除了浏览器主窗口显示的您请求的页面外，其他显示的各个部分都属于用户界面。
2. 浏览器引擎 - 在用户界面和呈现引擎之间传送指令。
3. 呈现引擎 - 负责显示请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。
4. 网络 - 用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。
5. 用户界面后端 - 用于绘制基本的窗口小部件，比如组合框和窗口。其公开了与平台无关的通用接口，而在底层使用操作系统的用户界面方法。
6. JavaScript 解释器。用于解析和执行 JavaScript 代码。
7. 数据存储。这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了“网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。

### 渲染引擎

## 流程

浏览器的主要工作流程：

1. 导航
   1. DNS 查找
   2. TCP 握手
   3. TLS 协商
   4. 响应
   5. TCP 慢开始/14kb 规则
   6. 拥塞控制
2. 解析
   1. 构建 DOM 树
   2. 预加载扫描器
   3. 构建 CSSOM 树
   4. 处理脚本
3. 渲染
   1. Style
   2. Layout
   3. Paint
   4. Compositing

### 解析

解析文档是指将文档转化成为有意义的结构，也就是可让代码理解和使用的结构。解析得到的结果通常是代表了文档结构的节点树，它称作解析树或者语法树。一旦浏览器收到数据的第一块，它就可以开始解析收到的信息。“推测性解析”，“解析”是浏览器将通过网络接收的数据转换为 DOM 和 CSSOM 的步骤，通过渲染器把 DOM 和 CSSOM 在屏幕上绘制成页面。

DOM 是浏览器标记的内部表示。DOM 也是被暴露的，可以通过 JavaScript 中的各种 API 进行 DOM 操作。

即使请求页面的 HTML 大于初始的 14KB 数据包，浏览器也将开始解析并尝试根据其拥有的数据进行渲染。这就是为什么在前 14Kb 中包含浏览器开始渲染页面所需的所有内容，或者至少包含页面模板（第一次渲染所需的 CSS 和 HTML）对于 web 性能优化来说是重要的。但是在渲染到屏幕上面之前，HTML、CSS、JavaScript 必须被解析完成。

#### 构建 DOM 树
